<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="三國天命放置小遊戲 - Three Kingdoms Destiny Idle Game">
    <title>三國天命 | SanGoAuto</title>

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="assets/images/favicon.png">

    <!-- CSS -->
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/animations.css">
    <link rel="stylesheet" href="css/game-layout.css">

    <!-- Preload critical resources -->
    <link rel="preload" href="js/core/game-engine.js" as="script">
    <link rel="preload" href="js/data/skills.json" as="fetch" crossorigin="anonymous">
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen" class="screen active">
        <div class="loading-content">
            <h1>三國天命</h1>
            <div class="loading-spinner"></div>
            <p id="loading-text">正在載入遊戲資源...</p>
        </div>
    </div>

    <!-- Main Menu -->
    <div id="main-menu" class="screen">
        <div class="menu-content">
            <header class="game-header">
                <h1 class="game-title">三國天命</h1>
                <p class="game-subtitle">放置養成小遊戲</p>
            </header>

            <nav class="main-nav">
                <button id="start-new-game" class="btn btn-primary">開始新遊戲</button>
                <button id="show-rules" class="btn btn-secondary">遊戲規則</button>
                <button id="show-settings" class="btn btn-secondary">設定</button>
            </nav>
        </div>
    </div>

    <!-- Skill Selection Screen -->
    <div id="skill-selection" class="screen">
        <div class="selection-content">
            <header class="selection-header">
                <h2>天命技能選擇</h2>
                <div class="stars-info">
                    <span>剩餘星星：</span>
                    <span id="remaining-stars" class="stars-count">10</span>
                    <span>輪數：</span>
                    <span id="current-round">1</span>/3
                </div>
            </header>

            <div class="skills-container">
                <div id="available-skills" class="skills-grid">
                    <!-- Skills will be populated by JavaScript -->
                </div>
            </div>

            <div class="selection-controls">
                <button id="skip-skill" class="btn btn-secondary">跳過此輪</button>
                <button id="confirm-selection" class="btn btn-primary" disabled>確認選擇</button>
            </div>
        </div>
    </div>

    <!-- Game Screen -->
    <div id="game-screen" class="screen">
        <div id="app">
            <!-- 頂部資訊欄 (純 DOM) -->
            <header id="top-bar" class="ui-block">
                <div id="player-name">玩家 Lv.<span id="player-level">1</span></div>
                <div id="stats">
                    <span class="stat">武力: <span id="stat-attack">0</span></span>
                    <span class="stat">智力: <span id="stat-skill">0</span></span>
                    <span class="stat">統治: <span id="stat-rule">0</span></span>
                    <span class="stat">政治: <span id="stat-politics">0</span></span>
                    <span class="stat">魅力: <span id="stat-charisma">0</span></span>
                </div>
                <div id="resources">
                    金錢: <span id="money">0</span> 兵力: <span id="troops">0</span> 城池: <span id="cities">0</span>
                </div>
            </header>

            <!-- 主內容區 -->
            <main id="main-area">
                <!-- Phaser 專屬容器（**唯一可被 Phaser 操作的 DOM**） -->
                <div id="phaser-root" class="phaser-block" aria-label="game-canvas"></div>

                <!-- UI Overlay：純 DOM (絕對定位) -->
                <div id="ui-overlay" class="ui-block">
                    <!-- 左下：事件日誌 (純 DOM) -->
                    <aside id="event-log" class="overlay left-bottom" aria-live="polite"></aside>

                    <!-- 右下或底部：Tabs 與列表（覆蓋於畫面下方） -->
                    <div id="bottom-tabs" class="overlay bottom-tabs">
                        <div class="tab-buttons">
                            <button data-tab="generals" class="tab-btn active">武將</button>
                            <button data-tab="cities" class="tab-btn">城池</button>
                            <button data-tab="gear" class="tab-btn">裝備</button>
                        </div>
                        <div id="tab-content" class="tab-content">
                            <!-- 切換顯示的 item 列表 -->
                        </div>
                    </div>
                </div>
            </main>

            <!-- 戰鬥 Modal (純 DOM) -->
            <div id="battle-modal" class="modal hidden" role="dialog" aria-hidden="true">
                <div id="battle-header"></div>
                <div id="battle-log"></div>
                <button id="battle-close">返回</button>
            </div>
        </div>
    </div>

    <!-- Game Over Screen -->
    <div id="game-over" class="screen">
        <div class="game-over-content">
            <h2 id="game-result-title">遊戲結束</h2>
            <div id="game-stats" class="stats-container">
                <!-- Game statistics will be populated by JavaScript -->
            </div>
            <div class="game-over-controls">
                <button id="restart-game" class="btn btn-primary">重新開始</button>
                <button id="return-menu" class="btn btn-secondary">返回主選單</button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <header class="modal-header">
                <h3>遊戲設定</h3>
                <button class="modal-close">&times;</button>
            </header>
            <div class="modal-body">
                <div class="setting-group">
                    <label for="language-select">語言 / Language:</label>
                    <select id="language-select">
                        <option value="zh">中文</option>
                        <option value="en">English</option>
                    </select>
                </div>
                <div class="setting-group">
                    <label>音效設定:</label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="sound-enabled" checked>
                        <span>音效</span>
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="music-enabled" checked>
                        <span>背景音樂</span>
                    </label>
                </div>
                <div class="setting-group">
                    <label for="autosave-interval">自動存檔間隔 (秒):</label>
                    <input type="range" id="autosave-interval" min="30" max="300" value="60" step="30">
                    <span id="autosave-display">60</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Rules Modal -->
    <div id="rules-modal" class="modal">
        <div class="modal-content">
            <header class="modal-header">
                <h3>遊戲規則</h3>
                <button class="modal-close">&times;</button>
            </header>
            <div class="modal-body">
                <div class="rules-content">
                    <!-- Game rules will be loaded from i18n -->
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/utils/helpers.js"></script>
    <script src="js/utils/logger.js"></script>
    <!-- Game API (Must load first for DOM-Phaser communication) -->
    <script src="js/ui/game-api.js"></script>
    <!-- Core Game Modules -->
    <script src="js/core/skill-system.js"></script>
    <script src="js/core/battle-system.js"></script>
    <script src="js/core/event-system.js"></script>
    <script src="js/core/turn-manager.js"></script>
    <script src="js/core/game-engine.js"></script>
    <!-- UI Components -->
    <script src="js/ui/components/skill-ui.js"></script>
    <script src="js/ui/components/game-ui.js"></script>
    <script src="js/ui/components/event-log-ui.js"></script>
    <script src="js/ui/ui-manager.js"></script>
    <script src="js/init-game.js"></script>
</body>
</html>