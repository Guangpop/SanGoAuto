<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº‹ä»¶æ—¥èªŒæ¸¬è©¦</title>

    <!-- CSS -->
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/game-layout.css">

    <style>
        body {
            background: #1a1a1a;
            color: white;
        }

        .test-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.9);
            color: black;
            padding: 20px;
            border-radius: 8px;
            z-index: 100;
        }

        .test-panel button {
            display: block;
            width: 100%;
            margin: 5px 0;
            padding: 10px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .status {
            margin-top: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }

        /* è®“äº‹ä»¶æ—¥èªŒæ›´æ˜é¡¯ */
        #event-log {
            border: 3px solid red !important;
            background: rgba(255, 255, 255, 1) !important;
        }

        .event-item {
            background: #e7f3ff;
            margin: 5px 0;
            padding: 8px;
            border-radius: 4px;
            border-left: 4px solid #007bff;
        }
    </style>
</head>
<body>
    <!-- ç°¡åŒ–çš„éŠæˆ²ç•«é¢çµæ§‹ -->
    <div id="app">
        <main id="main-area">
            <div id="phaser-root" class="phaser-block" style="background: #333;">
                <div style="color: white; text-align: center; padding-top: 200px;">
                    <h2>äº‹ä»¶æ—¥èªŒæ¸¬è©¦å€åŸŸ</h2>
                    <p>äº‹ä»¶æ—¥èªŒæ‡‰è©²é¡¯ç¤ºåœ¨å·¦ä¸‹è§’</p>
                </div>
            </div>

            <div id="ui-overlay" class="ui-block">
                <!-- äº‹ä»¶æ—¥èªŒ -->
                <aside id="event-log" class="overlay left-bottom" aria-live="polite">
                    <div class="event-item">åˆå§‹äº‹ä»¶ - å¦‚æœçœ‹åˆ°é€™å€‹ï¼Œèªªæ˜CSSæ­£å¸¸</div>
                </aside>

                <!-- åº•éƒ¨ Tabï¼ˆç°¡åŒ–ç‰ˆï¼‰ -->
                <div id="bottom-tabs" class="overlay bottom-tabs">
                    <div class="tab-buttons">
                        <button data-tab="test" class="tab-btn active">æ¸¬è©¦</button>
                    </div>
                    <div id="tab-content" class="tab-content">
                        æ¸¬è©¦å…§å®¹
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- æ¸¬è©¦æ§åˆ¶é¢æ¿ -->
    <div class="test-panel">
        <h3>ğŸ§ª äº‹ä»¶æ—¥èªŒæ¸¬è©¦</h3>
        <button onclick="testBasicEvent()">ğŸ“ æ¸¬è©¦åŸºæœ¬äº‹ä»¶</button>
        <button onclick="testMultipleEvents()">ğŸ“š æ¸¬è©¦å¤šå€‹äº‹ä»¶</button>
        <button onclick="testEventTypes()">ğŸ¨ æ¸¬è©¦äº‹ä»¶é¡å‹</button>
        <button onclick="testDirectAdd()">âš¡ ç›´æ¥æ·»åŠ æ¸¬è©¦</button>
        <button onclick="checkElements()">ğŸ” æª¢æŸ¥å…ƒç´ </button>
        <button onclick="clearLog()">ğŸ—‘ï¸ æ¸…ç©ºæ—¥èªŒ</button>
        <div class="status" id="test-status">
            æº–å‚™é–‹å§‹æ¸¬è©¦...
        </div>
    </div>

    <!-- è¼‰å…¥ gameAPI -->
    <script src="js/ui/game-api.js"></script>

    <script>
        const testStatus = document.getElementById('test-status');

        function addStatus(message) {
            const item = document.createElement('div');
            item.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            testStatus.appendChild(item);
            testStatus.scrollTop = testStatus.scrollHeight;
            console.log(message);
        }

        function testBasicEvent() {
            addStatus('æ¸¬è©¦åŸºæœ¬äº‹ä»¶...');
            if (window.gameAPI) {
                window.gameAPI.pushEventLog('ğŸ® é€™æ˜¯ä¸€å€‹æ¸¬è©¦äº‹ä»¶', { type: 'info' });
                addStatus('âœ… åŸºæœ¬äº‹ä»¶å·²ç™¼é€');
            } else {
                addStatus('âŒ gameAPI ä¸å­˜åœ¨');
            }
        }

        function testMultipleEvents() {
            addStatus('æ¸¬è©¦å¤šå€‹äº‹ä»¶...');
            const events = [
                'ğŸ° å»ºç«‹æ ¹æ“šåœ°',
                'ğŸ‘¥ æ‹›å‹Ÿå£«å…µ',
                'ğŸ’° æ”¶é›†ç¨…æ”¶',
                'âš”ï¸ ç™¼ç¾æ•µè»',
                'ğŸ¯ æº–å‚™æˆ°é¬¥'
            ];

            events.forEach((event, index) => {
                setTimeout(() => {
                    window.gameAPI.pushEventLog(event, { type: 'info' });
                    addStatus(`âœ… äº‹ä»¶ ${index + 1} å·²ç™¼é€`);
                }, index * 500);
            });
        }

        function testEventTypes() {
            addStatus('æ¸¬è©¦ä¸åŒäº‹ä»¶é¡å‹...');

            window.gameAPI.pushEventLog('â„¹ï¸ ä¸€èˆ¬è³‡è¨Šäº‹ä»¶', { type: 'info' });
            setTimeout(() => {
                window.gameAPI.pushEventLog('âš ï¸ è­¦å‘Šäº‹ä»¶', { type: 'warning' });
            }, 1000);
            setTimeout(() => {
                window.gameAPI.pushEventLog('âš”ï¸ æˆ°é¬¥äº‹ä»¶', { type: 'battle' });
            }, 2000);

            addStatus('âœ… ä¸‰ç¨®é¡å‹äº‹ä»¶å·²ç™¼é€');
        }

        function testDirectAdd() {
            addStatus('ç›´æ¥æ·»åŠ åˆ°DOMæ¸¬è©¦...');
            const eventLog = document.getElementById('event-log');

            if (eventLog) {
                const testItem = document.createElement('div');
                testItem.className = 'event-item';
                testItem.textContent = 'ğŸ”§ ç›´æ¥æ·»åŠ çš„æ¸¬è©¦äº‹ä»¶ - ' + new Date().toLocaleTimeString();
                testItem.style.background = '#ffeb3b';
                eventLog.appendChild(testItem);
                addStatus('âœ… ç›´æ¥æ·»åŠ æˆåŠŸ');
            } else {
                addStatus('âŒ æ‰¾ä¸åˆ°äº‹ä»¶æ—¥èªŒå…ƒç´ ');
            }
        }

        function checkElements() {
            addStatus('æª¢æŸ¥DOMå…ƒç´ ...');

            const eventLog = document.getElementById('event-log');
            addStatus(`äº‹ä»¶æ—¥èªŒå…ƒç´ : ${eventLog ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨'}`);

            if (eventLog) {
                const rect = eventLog.getBoundingClientRect();
                addStatus(`ä½ç½®: left=${rect.left}, top=${rect.top}, width=${rect.width}, height=${rect.height}`);
                addStatus(`å­å…ƒç´ æ•¸é‡: ${eventLog.children.length}`);
                addStatus(`æ¨£å¼å¯è¦‹: ${window.getComputedStyle(eventLog).display !== 'none' ? 'âœ… å¯è¦‹' : 'âŒ éš±è—'}`);
            }

            addStatus(`gameAPI å­˜åœ¨: ${window.gameAPI ? 'âœ… æ˜¯' : 'âŒ å¦'}`);
            if (window.gameAPI && window.gameAPI.pushEventLog) {
                addStatus(`pushEventLog å‡½æ•¸: âœ… å¯ç”¨`);
            } else {
                addStatus(`pushEventLog å‡½æ•¸: âŒ ä¸å¯ç”¨`);
            }
        }

        function clearLog() {
            const eventLog = document.getElementById('event-log');
            if (eventLog) {
                eventLog.innerHTML = '';
                addStatus('âœ… æ—¥èªŒå·²æ¸…ç©º');
            }
        }

        // é é¢è¼‰å…¥æ™‚è‡ªå‹•æª¢æŸ¥
        window.addEventListener('load', () => {
            addStatus('ğŸŒŸ äº‹ä»¶æ—¥èªŒæ¸¬è©¦é é¢å·²è¼‰å…¥');
            setTimeout(checkElements, 500);

            // è‡ªå‹•é‹è¡Œæ¸¬è©¦
            setTimeout(() => {
                addStatus('ğŸš€ é–‹å§‹è‡ªå‹•æ¸¬è©¦...');
                testBasicEvent();
                setTimeout(testEventTypes, 2000);
            }, 1000);
        });
    </script>
</body>
</html>