<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸¬è©¦ç©å®¶è³‡è¨Šæ›´æ–°</title>

    <!-- CSS -->
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/game-layout.css">

    <style>
        body { background: #1a1a1a; color: white; }

        .test-panel {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            color: lime;
            padding: 20px;
            border-radius: 8px;
            z-index: 1000;
            max-width: 400px;
            border: 2px solid lime;
        }

        .test-panel button {
            display: block;
            width: 100%;
            margin: 5px 0;
            padding: 8px;
            background: #333;
            color: lime;
            border: 1px solid lime;
            border-radius: 4px;
            cursor: pointer;
            font-family: monospace;
        }

        .test-panel button:hover {
            background: #555;
        }

        .status {
            background: #000;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #333;
        }

        #top-bar {
            border: 3px solid yellow !important;
            background: rgba(255, 255, 255, 0.1) !important;
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- é ‚éƒ¨è³‡è¨Šæ¬„ (ç´” DOM) -->
        <header id="top-bar" class="ui-block">
            <div id="player-name">ç©å®¶ Lv.<span id="player-level">1</span></div>
            <div id="stats">
                <span class="stat">æ­¦åŠ›: <span id="stat-attack">0</span></span>
                <span class="stat">æ™ºåŠ›: <span id="stat-skill">0</span></span>
                <span class="stat">çµ±æ²»: <span id="stat-rule">0</span></span>
                <span class="stat">æ”¿æ²»: <span id="stat-politics">0</span></span>
                <span class="stat">é­…åŠ›: <span id="stat-charisma">0</span></span>
            </div>
            <div id="resources">
                é‡‘éŒ¢: <span id="money">0</span> å…µåŠ›: <span id="troops">0</span> åŸæ± : <span id="cities">0</span>
            </div>
        </header>

        <main id="main-area">
            <div id="phaser-root" class="phaser-block">
                <div style="color: white; text-align: center; padding-top: 200px;">
                    <h2>ç©å®¶è³‡è¨Šæ›´æ–°æ¸¬è©¦</h2>
                    <p>æª¢æŸ¥ä¸Šæ–¹ç©å®¶è³‡è¨Šæ¬„æ˜¯å¦æ­£ç¢ºæ›´æ–°</p>
                </div>
            </div>
        </main>
    </div>

    <!-- æ¸¬è©¦é¢æ¿ -->
    <div class="test-panel">
        <h3>ğŸ§ª ç©å®¶è³‡è¨Šæ›´æ–°æ¸¬è©¦</h3>
        <button onclick="initGameAPI()">1. åˆå§‹åŒ– gameAPI</button>
        <button onclick="testBasicUpdate()">2. æ¸¬è©¦åŸºæœ¬æ•¸æ“šæ›´æ–°</button>
        <button onclick="testAdvancedUpdate()">3. æ¸¬è©¦é€²éšæ•¸æ“šæ›´æ–°</button>
        <button onclick="testGameEngineUpdate()">4. æ¨¡æ“¬éŠæˆ²å¼•æ“æ›´æ–°</button>
        <button onclick="testAutoUpdate()">5. æ¸¬è©¦è‡ªå‹•æ›´æ–°</button>
        <button onclick="checkElements()">6. æª¢æŸ¥DOMå…ƒç´ </button>
        <button onclick="clearStatus()">æ¸…é™¤ç‹€æ…‹</button>

        <div class="status" id="status-log">
            é»æ“Š"åˆå§‹åŒ– gameAPI"é–‹å§‹æ¸¬è©¦...
        </div>
    </div>

    <!-- è¼‰å…¥å¿…è¦è…³æœ¬ -->
    <script src="js/utils/helpers.js"></script>
    <script src="js/utils/logger.js"></script>
    <script src="js/ui/game-api.js"></script>

    <script>
        const statusLog = document.getElementById('status-log');

        function log(message, color = 'lime') {
            const time = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.style.color = color;
            entry.textContent = `[${time}] ${message}`;
            statusLog.appendChild(entry);
            statusLog.scrollTop = statusLog.scrollHeight;
            console.log(`[TEST] ${message}`);
        }

        function clearStatus() {
            statusLog.innerHTML = '';
        }

        function initGameAPI() {
            log('=== åˆå§‹åŒ– gameAPI ===', 'yellow');

            if (window.gameAPI) {
                log('âœ… gameAPI å·²å­˜åœ¨');
                window.gameAPI.init();
                log('âœ… gameAPI åˆå§‹åŒ–å®Œæˆ');
            } else {
                log('âŒ gameAPI ä¸å­˜åœ¨', 'red');
            }
        }

        function testBasicUpdate() {
            log('=== æ¸¬è©¦åŸºæœ¬æ•¸æ“šæ›´æ–° ===', 'yellow');

            if (!window.gameAPI) {
                log('âŒ gameAPI ä¸å­˜åœ¨ï¼Œè«‹å…ˆåˆå§‹åŒ–', 'red');
                return;
            }

            const testData = {
                level: 5,
                money: 1500,
                troops: 2500,
                cities: 3
            };

            log(`ğŸ“¤ ç™¼é€æ¸¬è©¦æ•¸æ“š: ${JSON.stringify(testData)}`);
            window.gameAPI.updatePlayerStats(testData);
            log('âœ… åŸºæœ¬æ•¸æ“šæ›´æ–°å®Œæˆ');
        }

        function testAdvancedUpdate() {
            log('=== æ¸¬è©¦é€²éšæ•¸æ“šæ›´æ–° ===', 'yellow');

            if (!window.gameAPI) {
                log('âŒ gameAPI ä¸å­˜åœ¨ï¼Œè«‹å…ˆåˆå§‹åŒ–', 'red');
                return;
            }

            const testData = {
                level: 8,
                money: 5000,
                troops: 4500,
                cities: 6,
                stats: {
                    attack: 45,
                    intellect: 38,
                    rule: 42,
                    politics: 35,
                    charisma: 50
                }
            };

            log(`ğŸ“¤ ç™¼é€å®Œæ•´æ¸¬è©¦æ•¸æ“š: ${JSON.stringify(testData)}`);
            window.gameAPI.updatePlayerStats(testData);
            log('âœ… é€²éšæ•¸æ“šæ›´æ–°å®Œæˆ');
        }

        function testGameEngineUpdate() {
            log('=== æ¨¡æ“¬éŠæˆ²å¼•æ“æ›´æ–° ===', 'yellow');

            // æ¨¡æ“¬éŠæˆ²å¼•æ“ç‹€æ…‹
            window.gameEngine = {
                gameState: {
                    player: {
                        level: 3,
                        gold: 800,
                        troops: 1200,
                        citiesControlled: 2,
                        attributes: {
                            strength: 25,
                            intelligence: 22,
                            leadership: 28,
                            politics: 20,
                            charisma: 18
                        }
                    }
                }
            };

            log('âœ… æ¨¡æ“¬éŠæˆ²å¼•æ“å·²å‰µå»º');

            // ä½¿ç”¨ turn-manager çš„æ›´æ–°æ–¹æ³•é‚è¼¯
            const player = window.gameEngine.gameState.player;
            const updateData = {
                level: player.level,
                money: player.gold,
                troops: player.troops,
                cities: player.citiesControlled,
                stats: {
                    attack: player.attributes.strength,
                    intellect: player.attributes.intelligence,
                    rule: player.attributes.leadership,
                    politics: player.attributes.politics,
                    charisma: player.attributes.charisma
                }
            };

            log(`ğŸ“¤ æ¨¡æ“¬éŠæˆ²å¼•æ“æ•¸æ“š: ${JSON.stringify(updateData)}`);
            window.gameAPI.updatePlayerStats(updateData);
            log('âœ… éŠæˆ²å¼•æ“æ¨¡æ“¬æ›´æ–°å®Œæˆ');
        }

        function testAutoUpdate() {
            log('=== æ¸¬è©¦è‡ªå‹•æ›´æ–° ===', 'yellow');

            let counter = 0;
            const interval = setInterval(() => {
                counter++;

                const randomData = {
                    level: Math.min(10, 1 + counter),
                    money: Math.floor(Math.random() * 5000) + 500,
                    troops: Math.floor(Math.random() * 3000) + 1000,
                    cities: Math.min(10, counter),
                    stats: {
                        attack: Math.floor(Math.random() * 50) + 10,
                        intellect: Math.floor(Math.random() * 50) + 10,
                        rule: Math.floor(Math.random() * 50) + 10,
                        politics: Math.floor(Math.random() * 50) + 10,
                        charisma: Math.floor(Math.random() * 50) + 10
                    }
                };

                log(`ğŸ”„ è‡ªå‹•æ›´æ–° #${counter}`);
                window.gameAPI.updatePlayerStats(randomData);

                if (counter >= 5) {
                    clearInterval(interval);
                    log('âœ… è‡ªå‹•æ›´æ–°æ¸¬è©¦å®Œæˆ', 'lime');
                }
            }, 1000);
        }

        function checkElements() {
            log('=== æª¢æŸ¥DOMå…ƒç´  ===', 'yellow');

            const elements = [
                'player-level', 'stat-attack', 'stat-skill', 'stat-rule',
                'stat-politics', 'stat-charisma', 'money', 'troops', 'cities'
            ];

            elements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    log(`âœ… ${id}: "${element.textContent}"`);
                } else {
                    log(`âŒ ${id}: å…ƒç´ ä¸å­˜åœ¨`, 'red');
                }
            });

            log('âœ… DOMå…ƒç´ æª¢æŸ¥å®Œæˆ');
        }

        // é é¢è¼‰å…¥æ™‚è‡ªå‹•åˆå§‹åŒ–
        window.addEventListener('load', () => {
            log('ğŸŒŸ æ¸¬è©¦é é¢å·²è¼‰å…¥', 'lime');
            setTimeout(() => {
                initGameAPI();
                setTimeout(() => {
                    checkElements();
                }, 500);
            }, 500);
        });
    </script>
</body>
</html>